<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>base</title>
	<style>
		a {
		  text-decoration: none;
      color: #fff;
		}
		@font-face {
			font-family: 'ico';
			src: url('g.ttf') format('truetype');
		}
		html {
			height: 101%;
		}
		body {
			background: #474747 url('data:image/gif;base64,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');
			color: #444;
			font-family: "Helvetica Neue", "Xin Gothic", "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft YaHei", sans-serif;
		}
		i {
			font-style: normal;
		}
		.wrapper {
			
			width: 640px;
			min-height: 600px;
			margin: 60px auto;
		}
		.header {
			
			height: 100px;
			opacity: 0.7;
			position: relative;
			color: #fff;
			font-weight: bold;
			font-size: 22px;
		}
		.header:hover {
			opacity: 1;
		}
		.header:before, .header:after {
		  
		  display: block;
		  content: ' ';
		  height: 2px;
		  background-color: #bdc3c7;
		  background: -moz-linear-gradient(45deg, #f9f9f9, #bdc3c7, #f9f9f9);
		  background: -webkit-linear-gradient(45deg, #f9f9f9, #bdc3c7, #f9f9f9);
		  background: -ms-linear-gradient(45deg, #f9f9f9, #bdc3c7, #f9f9f9);
		  background: linear-gradient(45deg, #f9f9f9, #999, #f9f9f9);
		  
		}
		.bar a {
			
		}
		.bar {
			
			text-align: center;
		}
		.bar a, .bar i {
			padding: 0 14px;			
			font-size: 20px;
			line-height: 70px;
		}
		.sep {
			opacity: 0.2;
		}
    .body {
      padding-bottom: 70px;
    }
		.artical {
			line-height:1.7;
			position: relative;
			margin-bottom: 70px;
			background-color: #fff;
			opacity: 0.5;
			padding: 10px 30px 30px 30px;
			color: #111;
			box-shadow: 1px 1px 2px #333;
			transition: all 0.1s ease-out 0s;
			
		}
		
		.artical:hover {
			opacity: 0.7;
			color: #000;
			box-shadow: 0 .3em 1em #333;
		}
		
		.artical-sidebar {
			position: absolute;
			height: 100%;
			
			width: 20px;
			z-index: 100;
			left: 0;
			top: 0;
			line-height: 100%;				
		}
		
		.artical-sidebar i {
			position: absolute;
			display: inline-block;
			width: 40px;
			z-index: -2;
			
			border-radius: 20px;
			height: 40px;
			background: rgb(94,195,191);
			opacity: 1;
			top: 40%;
			left: -20px;
			text-align: center;
		}
		
		div.artical {
      cursor: pointer; 
		}
    div.artical a {
      color: #3AA2B4;
      padding: 4px;
    }
    div.artical a:hover {
      color: #E26C6C;
    }
		div.nopointer  {
      cursor: auto;
    }
		.artical-title {
			color: #3AA2B4;
			font-size: 24px;
			border-bottom: 1px solid hsla(60, 100%, 30%, 1);
			margin: 10px 0;
		}
		
		.artical-sidebar i:before {
			font-family: ico;
			content: '\e80d';
			color: #fff;
			opacity: 1;
			line-height: 40px;
		}
		i[class^="icon-"]:before {
			font-family: ico;
			color: #fff;
			font-style: normal; 
			font-weight: normal;
			text-decoration: inherit;
			width: 1em;
			margin-right: .3em;
			font-size: 13px;
			line-height: 1em;
			text-align: center;
		}
		.icon-weibo:before { content: '\e80b'; } /* '' */
		.icon-home:before { content: '\e807'; } /* '' */
		.icon-note:before { content: '\e804'; } /* '' */
		.icon-comment:before { content: '\e802'; } /* '' */
		.icon-archive:before { content: '\e805'; } /* '' */
		.icon-archive-1:before { content: '\e808'; } /* '' */
		.icon-emo-sunglasses:before { content: '\e80d'; } /* '' */
		.icon-spin3:before { content: '\e80c'; } /* '' */
		.icon-github-circled-alt2:before { content: '\e806'; } /* '' */
		.icon-user:before { content: '\e80a'; } /* '' */
		.icon-list-numbered:before { content: '\e803'; } /* '' */
		.icon-mail-alt:before { content: '\e801'; } /* '' */
		.icon-picture:before { content: '\e800'; } /* '' */
		.icon-calendar:before { content: '\e809'; } /* '' */

    div.page,
    ul.list {
      color: #fff; 
    }
    

    .pull-right {
      float: right;
    }
    
		ul.list li {
      list-style-type: none;
      margin: 20px 0;
      color: #bbb;
      font-size: 16px;
    }
    ul.list li > span {
      display: inline-block;
      width: 300px;
    }
    ul.list li a {
      color: #3AA2B4;
    }
    ul.list li a:hover {
      color: #E26C6C;
    }
	</style>
</head>
<body>
<div class="wrapper">
	<div class="header">
		<div class="bar">
			<a href="/"><i>Home</i></a>
			<i class="sep">|</i>
			<a><i>Archive</i></a>
			<i class="sep">|</i>
			<a href="#date"><i>Date</i></a>
			<i class="sep">|</i>
			<a href="#about"><i>About</i></a>
		</div>
	</div>
	<div class="body">
  
	</div>
</div>

<script src="./fitemp.js"></script>
<script src="./marked.js"></script>

<script type="template" id="artical-tmpl">
	<div class="artical" onclick="location.hash = 'blog/<%=relative%>'" >
	<div class="artical-sidebar">
				<i></i>
			</div>
			<div class="artical-info">
				<div class="artical-title">
				<%=title%>
				</div>
				<div class="artical-date">
				<%=dateUTC%>
				</div>
			</div>
			<div class="artical-content">
        <%=preview%>
		</div>
	</div>
</script>

<script type="template" id="blog-tmpl">
	<div class="artical nopointer" >
	<div class="artical-sidebar">
				<i></i>
			</div>
			<div class="artical-info">
				<div class="artical-title">
				<%=title%>
				</div>
				<div class="artical-date">
				<%=dateUTC%>
				</div>
			</div>
			<div class="artical-content">
        <%=content%>
		</div>
	</div>
</script>

<script type="template" id="page-tmpl">
  <div class="page">
    <%if (1) {%>
      <div class="pull-right">
        <a href="#page/<%=(1+~~page)%>">下一页</a>
      </div>
    <%}%>

    <%if (page >= 2) {%>
      <div>
         <a href="#page/<%=(page-1)%>">上一页</a>
      </div>
    <%}%>
  </div>
</script>


<script type="template" id="list-tmpl">
  <ul class="list">
    <%for(var i = 0, one; one = arr[i]; i++) {%>
      <li>
        <span><%=one.day%></span>
        <a href="#blog/<%=one.relative%>">
          <span><%=one.title%></span>
        </a>
      </li>
    <%}%>
  </ul>
</script>

<script>

var host = 'http://42.121.108.75:88';

// get one blog

window.onload = onhashchange = hashChange;

function hashChange() {
  var hash = location.hash.substr(1).split('/');
  console.log(hash);
  if (hash[0] === 'date') {
    getBlogByDate();
  } else if (hash[0] === 'blog') {
    getBlogByOne(hash.slice(1));
  } else if (hash[0] === '') {
    getPreview(1);
  } else if (hash[0] === 'page') {
    getPreview(hash[1]);
  }
}

function getBlogByOne(arr) {
  console.log(arr);
  var blogname = arr.join('/');
  getJsonp({
    src: host+'/api/blog/' + blogname + '?callback=?',
    cb: function(result) {
      console.log(result);
      result.dateUTC = new Date(result.date).toUTCString();
      result.content = marked(result.content);
      var html = temp.render('blog-tmpl', result);
      mybody.innerHTML = html;
    }
  });
}


var mybody = document.querySelector('.body');


function getPreview(page) {
  page = page || 1;
  getJsonp({
    src: host+'/api/page/' + page + '?callback=?',
    cb: function(result) {
    
      var html = "";
      
      for (var i = 0, one; one = result[i]; i++) {
        
        one.dateUTC = new Date(one.date).toUTCString();
        one.preview = marked(one.content.split('\n').slice(0, 6).join('\n'));
        one.content = marked(one.content);
        one.title = one.title || 'FFFFF';
        html += temp.render('artical-tmpl', one);
        
      } 
      html += temp.render('page-tmpl', {page: page});   
      mybody.innerHTML = html;
    }
  });

}

function getBlogByDate() {

  getJsonp({
    src: host+'/api/all' + '?sort=time&callback=?',
    cb: function(result) {
      for (var i = 0, one; one = result[i]; i++) {
        one.day = new Date(one.date).toUTCString();
      }
     var html = temp.render('list-tmpl', {arr: result});
     console.log(html);
     console.log(mybody);
     mybody.innerHTML = html;
   
    }
  });

}


function getJsonp(o) {
  
  var script = document.createElement('script');
  var src = o.src;
  var index = 1;
  while (window['callback'+index]) {
    index++;
  }
  
  src = src.replace('=?', '=callback' + index);
  script.src = src;
  document.body.appendChild(script);
  //console.log(script);
  window['callback' + index] = o.cb;
  
}
</script>

</body>
</html>
